name: Deploy to Hetzner

# Manual only: push to main does NOT deploy. Use "Run workflow" when ready for production.
on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HETZNER_HOST }}
          username: ${{ secrets.HETZNER_USER }}
          key: ${{ secrets.HETZNER_SSH_KEY }}
          script: |
            cd /home/xflash/aitrackr
            bash scripts/deploy.sh

      - name: Notify success
        if: success()
        run: |
          echo "✅ Deployment successful"
          # Uncomment to add Slack notification:
          # curl -X POST -H 'Content-type: application/json' \
          #   --data '{"text":"✅ AiTrackr deployed successfully"}' \
          #   ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify failure
        if: failure()
        run: |
          echo "❌ Deployment failed"
          # curl -X POST ... ${{ secrets.SLACK_WEBHOOK_URL }}
